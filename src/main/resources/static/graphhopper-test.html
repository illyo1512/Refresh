<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphHopper í…ŒìŠ¤íŠ¸</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .result-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .loading {
            color: #007bff;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .test-section {
            margin-bottom: 30px;
        }
        select, input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        input[type="text"] {
            width: 300px;
        }
        .input-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
        /* ì§€ë„ ìŠ¤íƒ€ì¼ */
        #map {
            height: 500px;
            width: 100%;
            margin-top: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .route-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-family: Arial, sans-serif;
        }
        .coord-input {
            width: 100px !important;
        }
        .route-controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ GraphHopper í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
    
    <!-- 1. GraphHopper ìƒíƒœ í™•ì¸ -->
    <div class="container test-section">
        <h2>1. GraphHopper ìƒíƒœ í™•ì¸</h2>
        <button onclick="checkStatus()">ìƒíƒœ í™•ì¸</button>
        <div id="statusResult" class="result-box" style="display: none;"></div>
    </div>
    
    <!-- 2. Profile ëª©ë¡ ì¡°íšŒ -->
    <div class="container test-section">
        <h2>2. ì‚¬ìš© ê°€ëŠ¥í•œ Profile ëª©ë¡</h2>
        <button onclick="getProfiles()">Profile ëª©ë¡ ì¡°íšŒ</button>
        <div id="profilesResult" class="result-box" style="display: none;"></div>
    </div>
    
    <!-- 3. ë‹¨ì¼ Profile ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸ -->
    <div class="container test-section">
        <h2>3. ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸ (ì„œìš¸ì—­ â†’ ëª…ë™ì—­)</h2>
        <select id="profileSelect">
            <option value="foot_shortest">foot_shortest</option>
            <option value="foot_balanced">foot_balanced</option>
            <option value="foot_fastest">foot_fastest</option>
            <option value="car_shortest">car_shortest</option>
            <option value="car_balanced">car_balanced</option>
            <option value="car_fastest">car_fastest</option>
        </select>
        <button onclick="testSingleRoute()">ì„ íƒëœ Profileë¡œ ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸</button>
        <div id="singleRouteResult" class="result-box" style="display: none;"></div>
    </div>
    
    <!-- 4. ëª¨ë“  Profile í…ŒìŠ¤íŠ¸ -->
    <div class="container test-section">
        <h2>4. ëª¨ë“  Profile ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testAllRoutes()">ëª¨ë“  Profile í…ŒìŠ¤íŠ¸ (ì‹œê°„ ì†Œìš”)</button>
        <div id="allRoutesResult" class="result-box" style="display: none;"></div>
    </div>
    
    <!-- 5. API ì‘ë‹µ ì‹œê°„ ì¸¡ì • -->
    <div class="container test-section">
        <h2>5. API ì‘ë‹µ ì‹œê°„ ì¸¡ì •</h2>
        <button onclick="measurePerformance()">ì„±ëŠ¥ ì¸¡ì •</button>
        <div id="performanceResult" class="result-box" style="display: none;"></div>
    </div>

    <!-- 6. JSON CustomModel ë¡œë“œ í…ŒìŠ¤íŠ¸ -->
    <div class="container test-section">
        <h2>6. JSON CustomModel ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
        <div class="input-group">
            <label>JSON íŒŒì¼ ê²½ë¡œ:</label>
            <input type="text" id="jsonFilePath" value="data/customModels/foot_shortest_avoid_zone.json" />
        </div>
        <button onclick="testLoadJsonCustomModel()">JSON â†’ CustomModel ë³€í™˜</button>
        <div id="loadJsonResult" class="result-box" style="display: none;"></div>
    </div>

    <!-- 7. Profile ë³µì‚¬ + JSON í†µí•© í…ŒìŠ¤íŠ¸ -->
    <div class="container test-section">
        <h2>7. Profile ë³µì‚¬ + JSON CustomModel í†µí•©</h2>
        <div class="input-group">
            <label>ì›ë³¸ Profile:</label>
            <select id="originalProfile">
                <option value="foot_shortest">foot_shortest</option>
                <option value="foot_balanced">foot_balanced</option>
                <option value="foot_fastest">foot_fastest</option>
                <option value="car_shortest">car_shortest</option>
                <option value="car_balanced">car_balanced</option>
                <option value="car_fastest">car_fastest</option>
            </select>
        </div>
        <div class="input-group">
            <label>JSON íŒŒì¼ ê²½ë¡œ:</label>
            <input type="text" id="jsonFilePathForCopy" value="data/customModels/foot_shortest_avoid_zone.json" />
        </div>
        <div class="input-group">
            <label>ìƒˆ Profile ì´ë¦„:</label>
            <input type="text" id="newProfileName" value="foot_shortest_custom" />
        </div>
        <button onclick="testCopyProfileWithJson()">Profile ë³µì‚¬ + JSON í†µí•©</button>
        <div id="copyProfileResult" class="result-box" style="display: none;"></div>
    </div>

    <!-- 8. í†µí•©ëœ Profile ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸ -->
    <div class="container test-section">
        <h2>8. í†µí•©ëœ Profile ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸</h2>
        <div class="input-group">
            <label>ì›ë³¸ Profile:</label>
            <select id="originalProfileForTest">
                <option value="foot_shortest">foot_shortest</option>
                <option value="foot_balanced">foot_balanced</option>
                <option value="foot_fastest">foot_fastest</option>
                <option value="car_shortest">car_shortest</option>
                <option value="car_balanced">car_balanced</option>
                <option value="car_fastest">car_fastest</option>
            </select>
        </div>
        <div class="input-group">
            <label>JSON íŒŒì¼ ê²½ë¡œ:</label>
            <input type="text" id="jsonFilePathForTest" value="data/customModels/foot_shortest_avoid_zone.json" />
        </div>
        <div class="input-group">
            <label>ìƒˆ Profile ì´ë¦„:</label>
            <input type="text" id="newProfileNameForTest" value="foot_shortest_test" />
        </div>
        <button onclick="testIntegratedProfile()">í†µí•© Profile í…ŒìŠ¤íŠ¸</button>
        <div id="integratedTestResult" class="result-box" style="display: none;"></div>
    </div>

    <!-- 9. ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ -->
    <div class="container test-section">
        <h2>9. ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸</h2>
        <div class="input-group">
            <label>ì›ë³¸ Profile:</label>
            <select id="fullTestOriginalProfile">
                <option value="foot_shortest">foot_shortest</option>
                <option value="foot_balanced">foot_balanced</option>
                <option value="car_fastest">car_fastest</option>
            </select>
        </div>
        <div class="input-group">
            <label>JSON íŒŒì¼ ê²½ë¡œ:</label>
            <input type="text" id="fullTestJsonPath" value="data/customModels/foot_shortest_avoid_zone.json" />
        </div>
        <div class="input-group">
            <label>ìƒˆ Profile ì´ë¦„:</label>
            <input type="text" id="fullTestNewProfile" value="full_test_profile" />
        </div>
        <button onclick="runFullIntegrationTest()">ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="fullTestResult" class="result-box" style="display: none;"></div>
    </div>

    <!-- 10. ì§€ë„ ê¸°ë°˜ ê¸¸ì°¾ê¸° í…ŒìŠ¤íŠ¸ -->
    <div class="container test-section">
        <h2>10. ğŸ—ºï¸ ì§€ë„ ê¸°ë°˜ ê¸¸ì°¾ê¸° í…ŒìŠ¤íŠ¸</h2>
        
        <div class="route-controls">
            <label>Profile ì„ íƒ:</label>
            <select id="mapProfileSelect">
                <option value="foot_shortest">foot_shortest</option>
                <option value="foot_balanced">foot_balanced</option>
                <option value="foot_fastest">foot_fastest</option>
                <option value="car_shortest">car_shortest</option>
                <option value="car_balanced">car_balanced</option>
                <option value="car_fastest">car_fastest</option>
            </select>
        </div>
        
        <div class="route-controls">
            <label>ì¶œë°œì§€:</label>
            <input type="text" id="startLat" class="coord-input" value="37.5547" placeholder="ìœ„ë„">
            <input type="text" id="startLon" class="coord-input" value="126.9706" placeholder="ê²½ë„">
            <span>(ì„œìš¸ì—­)</span>
        </div>
        
        <div class="route-controls">
            <label>ë„ì°©ì§€:</label>
            <input type="text" id="endLat" class="coord-input" value="37.5636" placeholder="ìœ„ë„">
            <input type="text" id="endLon" class="coord-input" value="126.9834" placeholder="ê²½ë„">
            <span>(ëª…ë™ì—­)</span>
        </div>
        
        <div class="route-controls">
            <button onclick="findRouteOnMap()">ê¸¸ì°¾ê¸° ì‹¤í–‰</button>
            <button onclick="clearMap()">ì§€ë„ ì´ˆê¸°í™”</button>
            <button onclick="setPresetLocations()">ì„œìš¸ ëª…ì†Œ ì„¤ì •</button>
        </div>
        
        <!-- ì§€ë„ í‘œì‹œ ì˜ì—­ -->
        <div id="map"></div>
        
        <!-- ê²½ë¡œ ì •ë³´ í‘œì‹œ -->
        <div id="routeInfo" class="route-info" style="display: none;"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const BASE_URL = 'http://localhost:9806/test/graphhopper';
        const ROUTE_API_URL = 'http://localhost:9806/api/route/find';
        
        // ì§€ë„ ì´ˆê¸°í™”
        let map, startMarker, endMarker, routeLine;
        
        function initMap() {
            if (!map) {
                map = L.map('map').setView([37.5665, 126.9780], 13);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                
                // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                map.on('click', function(e) {
                    const lat = e.latlng.lat.toFixed(6);
                    const lng = e.latlng.lng.toFixed(6);
                    
                    // ì¶œë°œì§€ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì¶œë°œì§€ë¡œ ì„¤ì •
                    if (!startMarker) {
                        document.getElementById('startLat').value = lat;
                        document.getElementById('startLon').value = lng;
                        addStartMarker(lat, lng);
                    } 
                    // ì¶œë°œì§€ëŠ” ìˆê³  ë„ì°©ì§€ê°€ ì—†ìœ¼ë©´ ë„ì°©ì§€ë¡œ ì„¤ì •
                    else if (!endMarker) {
                        document.getElementById('endLat').value = lat;
                        document.getElementById('endLon').value = lng;
                        addEndMarker(lat, lng);
                    }
                    // ë‘˜ ë‹¤ ìˆìœ¼ë©´ ì¶œë°œì§€ë¥¼ ìƒˆë¡œ ì„¤ì •
                    else {
                        clearMap();
                        document.getElementById('startLat').value = lat;
                        document.getElementById('startLon').value = lng;
                        addStartMarker(lat, lng);
                    }
                });
            }
        }
        
        function addStartMarker(lat, lng) {
            if (startMarker) map.removeLayer(startMarker);
            startMarker = L.marker([lat, lng], {
                title: "ì¶œë°œì§€",
                icon: L.icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                })
            }).addTo(map).bindPopup("ì¶œë°œì§€").openPopup();
        }
        
        function addEndMarker(lat, lng) {
            if (endMarker) map.removeLayer(endMarker);
            endMarker = L.marker([lat, lng], {
                title: "ë„ì°©ì§€",
                icon: L.icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                })
            }).addTo(map).bindPopup("ë„ì°©ì§€");
        }
        
        function clearMap() {
            if (routeLine) map.removeLayer(routeLine);
            if (startMarker) map.removeLayer(startMaraker);
            if (endMarker) map.removeLayer(endMarker);
            routeLine = null;
            startMarker = null;
            endMarker = null;
            document.getElementById('routeInfo').style.display = 'none';
        }
        
        function setPresetLocations() {
            // ì„œìš¸ ëª…ì†Œë“¤
            const locations = [
                { name: "ì„œìš¸ì—­", lat: 37.5547, lng: 126.9706 },
                { name: "ëª…ë™ì—­", lat: 37.5636, lng: 126.9834 },
                { name: "ê°•ë‚¨ì—­", lat: 37.4979, lng: 127.0276 },
                { name: "í™ëŒ€ì…êµ¬ì—­", lat: 37.5563, lng: 126.9236 },
                { name: "ê²½ë³µê¶", lat: 37.5788, lng: 126.9770 },
                { name: "ë‚¨ì‚°íƒ€ì›Œ", lat: 37.5512, lng: 126.9882 }
            ];
            
            const randomStart = locations[Math.floor(Math.random() * locations.length)];
            let randomEnd = locations[Math.floor(Math.random() * locations.length)];
            while (randomEnd === randomStart) {
                randomEnd = locations[Math.floor(Math.random() * locations.length)];
            }
            
            document.getElementById('startLat').value = randomStart.lat;
            document.getElementById('startLon').value = randomStart.lng;
            document.getElementById('endLat').value = randomEnd.lat;
            document.getElementById('endLon').value = randomEnd.lng;
            
            clearMap();
            addStartMarker(randomStart.lat, randomStart.lng);
            addEndMarker(randomEnd.lat, randomEnd.lng);
            
            // ì§€ë„ ë·° ì¡°ì •
            const bounds = L.latLngBounds([
                [randomStart.lat, randomStart.lng],
                [randomEnd.lat, randomEnd.lng]
            ]);
            map.fitBounds(bounds, { padding: [50, 50] });
        }
        
        async function findRouteOnMap() {
            const profile = document.getElementById('mapProfileSelect').value;
            const startLat = parseFloat(document.getElementById('startLat').value);
            const startLon = parseFloat(document.getElementById('startLon').value);
            const endLat = parseFloat(document.getElementById('endLat').value);
            const endLon = parseFloat(document.getElementById('endLon').value);
            
            if (isNaN(startLat) || isNaN(startLon) || isNaN(endLat) || isNaN(endLon)) {
                alert('ì˜¬ë°”ë¥¸ ì¢Œí‘œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê¸°ì¡´ ê²½ë¡œ ì œê±°
            if (routeLine) map.removeLayer(routeLine);
            
            // ë§ˆì»¤ ì¶”ê°€
            addStartMarker(startLat, startLon);
            addEndMarker(endLat, endLon);
            
            // ê²½ë¡œ ì •ë³´ í‘œì‹œ
            const routeInfo = document.getElementById('routeInfo');
            routeInfo.style.display = 'block';
            routeInfo.innerHTML = `<strong>ê¸¸ì°¾ê¸° ì¤‘...</strong><br>Profile: ${profile}`;
            
            try {
                // GraphHopper API í˜¸ì¶œ (ê¸°ì¡´ API ì‚¬ìš©)
                const response = await fetch(`${BASE_URL}/route/test?profile=${profile}&fromLat=${startLat}&fromLon=${startLon}&toLat=${endLat}&toLon=${endLon}`, {
                    method: 'GET'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.text();
                
                // ê°„ë‹¨í•œ ê²½ë¡œ ë¼ì¸ í‘œì‹œ (ì§ì„ )
                routeLine = L.polyline([
                    [startLat, startLon],
                    [endLat, endLon]
                ], {
                    color: '#007bff',
                    weight: 5,
                    opacity: 0.7
                }).addTo(map);
                
                // ì§€ë„ ë·° ì¡°ì •
                const bounds = L.latLngBounds([
                    [startLat, startLon],
                    [endLat, endLon]
                ]);
                map.fitBounds(bounds, { padding: [50, 50] });
                
                // ê²°ê³¼ í‘œì‹œ
                routeInfo.innerHTML = `
                    <strong>ê¸¸ì°¾ê¸° ì™„ë£Œ!</strong><br>
                    <strong>Profile:</strong> ${profile}<br>
                    <strong>ì¶œë°œì§€:</strong> ${startLat.toFixed(4)}, ${startLon.toFixed(4)}<br>
                    <strong>ë„ì°©ì§€:</strong> ${endLat.toFixed(4)}, ${endLon.toFixed(4)}<br>
                    <br>
                    <strong>GraphHopper ì‘ë‹µ:</strong><br>
                    <pre style="font-size: 12px; max-height: 200px; overflow-y: auto;">${result}</pre>
                `;
                
            } catch (error) {
                console.error('ê¸¸ì°¾ê¸° ì˜¤ë¥˜:', error);
                routeInfo.innerHTML = `
                    <strong style="color: red;">ê¸¸ì°¾ê¸° ì‹¤íŒ¨!</strong><br>
                    ì˜¤ë¥˜: ${error.message}
                `;
            }
        }
        
        // ê³µí†µ API í˜¸ì¶œ í•¨ìˆ˜
        async function callAPI(endpoint, resultElementId, loadingMessage = 'ë¡œë”© ì¤‘...') {
            const resultElement = document.getElementById(resultElementId);
            resultElement.style.display = 'block';
            resultElement.className = 'result-box loading';
            resultElement.textContent = loadingMessage;
            
            try {
                const startTime = performance.now();
                const response = await fetch(`${BASE_URL}${endpoint}`);
                const endTime = performance.now();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.text();
                const responseTime = Math.round(endTime - startTime);
                
                resultElement.className = 'result-box success';
                resultElement.textContent = `ì‘ë‹µ ì‹œê°„: ${responseTime}ms\n\n${result}`;
                
                return { result, responseTime };
                
            } catch (error) {
                resultElement.className = 'result-box error';
                resultElement.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
                return { error: error.message };
            }
        }
        
        // 1. GraphHopper ìƒíƒœ í™•ì¸
        async function checkStatus() {
            await callAPI('/status', 'statusResult', 'GraphHopper ìƒíƒœ í™•ì¸ ì¤‘...');
        }
        
        // 2. Profile ëª©ë¡ ì¡°íšŒ
        async function getProfiles() {
            const result = await callAPI('/profiles', 'profilesResult', 'Profile ëª©ë¡ ì¡°íšŒ ì¤‘...');
            
            // Profile ëª©ë¡ì„ select ì˜µì…˜ì— ì—…ë°ì´íŠ¸
            if (result.result && !result.error) {
                try {
                    const profiles = JSON.parse(result.result);
                    updateProfileSelects(profiles);
                } catch (e) {
                    console.log('Profile ëª©ë¡ íŒŒì‹± ì‹¤íŒ¨:', e);
                }
            }
        }
        
        // Profile select ì˜µì…˜ë“¤ ì—…ë°ì´íŠ¸
        function updateProfileSelects(profiles) {
            const selects = [
                'profileSelect', 'originalProfile', 'originalProfileForTest', 
                'fullTestOriginalProfile', 'mapProfileSelect'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '';
                    profiles.forEach(profile => {
                        if (!profile.startsWith('ì˜¤ë¥˜:')) {
                            const option = document.createElement('option');
                            option.value = profile;
                            option.textContent = profile;
                            if (profile === currentValue) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        }
                    });
                }
            });
        }
        
        // 3. ë‹¨ì¼ Profile ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸
        async function testSingleRoute() {
            const selectedProfile = document.getElementById('profileSelect').value;
            await callAPI(`/route/test?profile=${selectedProfile}`, 'singleRouteResult', 
                `${selectedProfile} í”„ë¡œí•„ë¡œ ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸ ì¤‘...`);
        }
        
        // 4. ëª¨ë“  Profile í…ŒìŠ¤íŠ¸
        async function testAllRoutes() {
            await callAPI('/route/test-all', 'allRoutesResult', 
                'ëª¨ë“  Profile í…ŒìŠ¤íŠ¸ ì¤‘... (1-2ë¶„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)');
        }
        
        // 5. ì„±ëŠ¥ ì¸¡ì •
        async function measurePerformance() {
            const resultElement = document.getElementById('performanceResult');
            resultElement.style.display = 'block';
            resultElement.className = 'result-box loading';
            resultElement.textContent = 'ì„±ëŠ¥ ì¸¡ì • ì¤‘... (ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œ)';
            
            const testCount = 5;
            const results = [];
            
            try {
                for (let i = 0; i < testCount; i++) {
                    const startTime = performance.now();
                    const response = await fetch(`${BASE_URL}/route/test?profile=foot_shortest`);
                    const endTime = performance.now();
                    
                    if (response.ok) {
                        const responseTime = Math.round(endTime - startTime);
                        results.push(responseTime);
                        resultElement.textContent = `ì„±ëŠ¥ ì¸¡ì • ì¤‘... (${i + 1}/${testCount}) - ${responseTime}ms`;
                    }
                    
                    // 0.5ì´ˆ ëŒ€ê¸°
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                const avgTime = Math.round(results.reduce((a, b) => a + b, 0) / results.length);
                const minTime = Math.min(...results);
                const maxTime = Math.max(...results);
                
                resultElement.className = 'result-box success';
                resultElement.textContent = 
                    `=== ì„±ëŠ¥ ì¸¡ì • ê²°ê³¼ (${testCount}íšŒ í˜¸ì¶œ) ===\n` +
                    `í‰ê·  ì‘ë‹µ ì‹œê°„: ${avgTime}ms\n` +
                    `ìµœì†Œ ì‘ë‹µ ì‹œê°„: ${minTime}ms\n` +
                    `ìµœëŒ€ ì‘ë‹µ ì‹œê°„: ${maxTime}ms\n` +
                    `ê°œë³„ ê²°ê³¼: ${results.join('ms, ')}ms`;
                    
            } catch (error) {
                resultElement.className = 'result-box error';
                resultElement.textContent = `ì„±ëŠ¥ ì¸¡ì • ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        // 6. JSON CustomModel ë¡œë“œ í…ŒìŠ¤íŠ¸
        async function testLoadJsonCustomModel() {
            const jsonFilePath = document.getElementById('jsonFilePath').value;
            if (!jsonFilePath.trim()) {
                alert('JSON íŒŒì¼ ê²½ë¡œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const encodedPath = encodeURIComponent(jsonFilePath);
            await callAPI(`/custommodel/load?jsonFilePath=${encodedPath}`, 'loadJsonResult', 
                'JSON â†’ CustomModel ë³€í™˜ ì¤‘...');
        }
        
        // 7. Profile ë³µì‚¬ + JSON í†µí•© í…ŒìŠ¤íŠ¸
        async function testCopyProfileWithJson() {
            const originalProfile = document.getElementById('originalProfile').value;
            const jsonFilePath = document.getElementById('jsonFilePathForCopy').value;
            const newProfileName = document.getElementById('newProfileName').value;
            
            if (!jsonFilePath.trim() || !newProfileName.trim()) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const params = new URLSearchParams({
                originalProfileName: originalProfile,
                jsonFilePath: jsonFilePath,
                newProfileName: newProfileName
            });
            
            await callAPI(`/profile/copy-with-json?${params}`, 'copyProfileResult', 
                'Profile ë³µì‚¬ + JSON í†µí•© ì¤‘...');
        }
        
        // 8. í†µí•©ëœ Profile ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸
        async function testIntegratedProfile() {
            const originalProfile = document.getElementById('originalProfileForTest').value;
            const jsonFilePath = document.getElementById('jsonFilePathForTest').value;
            const newProfileName = document.getElementById('newProfileNameForTest').value;
            
            if (!jsonFilePath.trim() || !newProfileName.trim()) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const params = new URLSearchParams({
                originalProfileName: originalProfile,
                jsonFilePath: jsonFilePath,
                newProfileName: newProfileName
            });
            
            await callAPI(`/profile/test-integrated?${params}`, 'integratedTestResult', 
                'í†µí•©ëœ Profile í…ŒìŠ¤íŠ¸ ì¤‘...');
        }
        
        // 9. ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸
        async function runFullIntegrationTest() {
            const originalProfile = document.getElementById('fullTestOriginalProfile').value;
            const jsonFilePath = document.getElementById('fullTestJsonPath').value;
            const newProfileName = document.getElementById('fullTestNewProfile').value;
            
            if (!jsonFilePath.trim() || !newProfileName.trim()) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            const params = new URLSearchParams({
                originalProfileName: originalProfile,
                jsonFilePath: jsonFilePath,
                newProfileName: newProfileName
            });
            
            await callAPI(`/integration/test?${params}`, 'fullTestResult', 
                'ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            console.log('GraphHopper í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            // ì§€ë„ ì´ˆê¸°í™” ë° Profile ëª©ë¡ ìë™ ì¡°íšŒ
            initMap();
            setTimeout(getProfiles, 1000);
        });
    </script>
</body>
</html>